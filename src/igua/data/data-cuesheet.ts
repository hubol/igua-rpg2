import { Logger } from "../../lib/game-engine/logger";
import { Integer } from "../../lib/math/number-alias-types";

export type DataCuesheet<TCommand> = Array<[start: number, end: number, command: TCommand, data: string | null]>;

export namespace DataCuesheet {
    export const SoldierBoyDemo: DataCuesheet<"beat" | "key" | "lyric" | "lip" | "misc" | "offbeat"> = [
        [0.595319, 0.595319, "misc", "guitar_start"],
        [0.617678, 0.617678, "beat", null],
        [2.906722, 2.906722, "misc", "keys_start"],
        [2.912312, 2.912312, "beat", null],
        [4.399293, 4.399293, "key", "high"],
        [4.568369, 4.568369, "key", "high"],
        [4.933043, 4.933043, "key", "high"],
        [5.097944, 5.097944, "beat", null],
        [7.283575, 7.283575, "beat", null],
        [8.631168, 8.631168, "key", "high"],
        [8.82345, 8.82345, "key", "high"],
        [9.194754, 9.194754, "key", "high"],
        [9.386756, 9.386756, "misc", "bass_start"],
        [9.438462, 9.438462, "beat", null],
        [9.734724, 11.607324, "lyric", "I threw up in the"],
        [9.734724, 9.969498, "lip", "i"],
        [9.969498, 10.109244, "lip", "th"],
        [10.109244, 10.274145, "lip", "o"],
        [10.274145, 10.47538, "lip", "O"],
        [10.47538, 10.47538, "lip", "p"],
        [10.626306, 10.729718, "lip", "i"],
        [10.729718, 11.034365, "lip", "n"],
        [11.034365, 11.204855, "lip", "th"],
        [11.204855, 11.392115, "lip", "uh"],
        [11.392115, 11.604529, "lip", "UH"],
        [11.601734, 11.741481, "lip", "t"],
        [11.607324, 13.127764, "lyric", "toilet bowl"],
        [11.674403, 11.674403, "beat", null],
        [11.741481, 11.920356, "lip", "o"],
        [11.920356, 12.051717, "lip", "l"],
        [12.051717, 12.146745, "lip", "e"],
        [12.146745, 12.468161, "lip", "t"],
        [12.468161, 12.585548, "lip", "b"],
        [12.585548, 12.797962, "lip", "o"],
        [12.797962, 13.133353, "lip", "l"],
        [13.043721, 13.043721, "key", "high"],
        [13.267499, 13.267499, "key", "high"],
        [13.761466, 13.761466, "key", "high"],
        [13.778981, 13.778981, "beat", null],
        [15.374883, 17.781314, "lyric", "Watched the big ol' sun come"],
        [15.374883, 15.450346, "lip", "w"],
        [15.450346, 15.51463, "lip", "a"],
        [15.51463, 15.6963, "lip", "ch"],
        [15.6963, 15.774558, "lip", "f"],
        [15.774558, 15.886355, "lip", "uh"],
        [15.886355, 15.886355, "beat", null],
        [15.886355, 16.009331, "lip", "b"],
        [16.009331, 16.151873, "lip", "i"],
        [16.151873, 16.216156, "lip", "e"],
        [16.216156, 16.364287, "lip", "o"],
        [16.364287, 16.484469, "lip", "l"],
        [16.484469, 16.733217, "lip", "s"],
        [16.733217, 16.909297, "lip", "uh"],
        [16.909297, 17.018299, "lip", "n"],
        [17.236304, 17.339716, "lip", "c"],
        [17.339716, 17.473872, "lip", "UH"],
        [17.473872, 17.649953, "lip", "m"],
        [18.010498, 18.010498, "beat", null],
        [18.010498, 20.014459, "lyric", "Through my window"],
        [18.010498, 18.1195, "lip", "th"],
        [18.1195, 18.264836, "lip", "r"],
        [18.264836, 18.387813, "lip", "m"],
        [18.387813, 18.678485, "lip", "i"],
        [18.678485, 18.865745, "lip", "w"],
        [18.865745, 19.005491, "lip", "a"],
        [19.005491, 19.125673, "lip", "n"],
        [19.125673, 19.421935, "lip", "o"],
        [19.421935, 20.014459, "lip", "O"],
        [20.126256, 20.126256, "beat", null],
        [20.629343, 26.476326, "lyric", "Need to let you know"],
        [20.629343, 20.72437, "lip", "n"],
        [20.72437, 20.866911, "lip", "e"],
        [20.866911, 20.956349, "lip", "t"],
        [20.956349, 21.068146, "lip", "o"],
        [21.068146, 21.241431, "lip", "l"],
        [21.241431, 21.414717, "lip", "e"],
        [21.414717, 21.571233, "lip", "ch"],
        [21.571233, 22.096679, "lip", "u"],
        [22.096679, 22.255989, "lip", "n"],
        [22.255989, 23.782018, "lip", "o"],
        [22.275554, 22.275554, "beat", null],
        [22.291519, 22.291519, "key", "high"],
        [23.188286, 23.188286, "key", "high"],
        [23.702144, 23.702144, "key", "high"],
        [23.782018, 24.48075, "lip", "O"],
        [23.884481, 23.884481, "key", "high"],
        [24.477955, 24.477955, "beat", null],
        [24.477955, 26.465147, "lip", "o"],
        [26.627252, 26.627252, "beat", null],
        [27.082825, 30.509403, "lyric", "In need of sympathy"],
        [27.082825, 27.468525, "lip", "i"],
        [27.468525, 27.739632, "lip", "n"],
        [27.739632, 28.22036, "lip", "e"],
        [28.22036, 28.346131, "lip", "d"],
        [28.346131, 28.480288, "lip", "uh"],
        [28.480288, 28.569725, "lip", "v"],
        [28.569725, 28.798909, "lip", "s"],
        [28.777742, 28.777742, "key", "high"],
        [28.798909, 28.798909, "beat", null],
        [28.798909, 29.056042, "lip", "i"],
        [29.056042, 29.371869, "lip", "m"],
        [29.371869, 29.656951, "lip", "uh"],
        [29.656951, 29.824647, "lip", "th"],
        [29.824647, 30.512198, "lip", "e"],
        [30.168475, 30.168475, "key", "high"],
        [30.35247, 30.35247, "key", "high"],
        [30.70554, 30.70554, "key", "high"],
        [30.939822, 30.939822, "beat", null],
        [31.496012, 33.175762, "lyric", "Damn, I wish you were"],
        [31.496012, 31.624578, "lip", "d"],
        [31.624578, 31.76153, "lip", "a"],
        [31.76153, 31.850967, "lip", "m"],
        [31.850967, 31.945995, "lip", "i"],
        [31.945995, 32.091331, "lip", "w"],
        [32.091331, 32.370824, "lip", "a"],
        [32.370824, 32.633546, "lip", "sh"],
        [32.633546, 32.739754, "lip", "y"],
        [32.739754, 32.974527, "lip", "o"],
        [32.974527, 33.170172, "lip", "e"],
        [33.170172, 33.267994, "lip", "h"],
        [33.175762, 34.475402, "lyric", "Here with me"],
        [33.184147, 33.184147, "beat", null],
        [33.267994, 33.684438, "lip", "e"],
        [33.684438, 33.773876, "lip", "w"],
        [33.773876, 33.868903, "lip", "a"],
        [33.868903, 34.011445, "lip", "th"],
        [34.011445, 34.131626, "lip", "m"],
        [34.131626, 34.458633, "lip", "e"],
        [34.458633, 34.601174, "lip", "r"],
        [34.475402, 39.251929, "lyric", "Right now"],
        [34.601174, 34.782844, "lip", "i"],
        [34.612523, 34.612523, "key", "high"],
        [34.782844, 34.782844, "key", "high"],
        [34.782844, 34.92818, "lip", "o"],
        [34.788434, 34.788434, "offbeat", null],
        [34.92818, 35.154569, "lip", "n"],
        [35.084696, 35.084696, "offbeat", null],
        [35.096545, 35.096545, "key", "high"],
        [35.154569, 36.929346, "lip", "O"],
        [35.341829, 35.341829, "beat", null],
        [36.929346, 37.616898, "lip", "a"],
        [37.468767, 37.468767, "beat", null],
        [37.616898, 38.86064, "lip", "O"],
        [38.3438, 38.3438, "key", "high"],
        [38.86064, 39.251929, "lip", "o"],
        [39.634834, 39.634834, "beat", null],
        [39.830479, 39.936686, "lip", "o"],
        [39.836069, 41.708669, "lyric", "And maybe we could"],
        [39.936686, 40.009354, "lip", "n"],
        [40.009354, 40.224563, "lip", "m"],
        [40.224563, 40.490081, "lip", "a"],
        [40.490081, 40.607468, "lip", "o"],
        [40.607468, 40.730445, "lip", "e"],
        [40.730445, 40.847832, "lip", "w"],
        [40.847832, 41.09658, "lip", "a"],
        [41.09658, 41.183223, "lip", "e"],
        [41.183223, 41.269865, "lip", "c"],
        [41.269865, 41.504639, "lip", "O"],
        [41.504639, 41.610846, "lip", "d"],
        [41.753387, 43.754554, "lyric", "Go to town"],
        [41.753387, 41.890339, "lip", "g"],
        [41.854005, 41.854005, "beat", null],
        [41.890339, 42.200575, "lip", "O"],
        [42.200575, 42.326347, "lip", "t"],
        [42.326347, 42.717637, "lip", "o"],
        [42.717637, 42.840613, "lip", "t"],
        [42.840613, 43.075387, "lip", "O"],
        [43.075387, 43.455497, "lip", "o"],
        [43.270213, 43.270213, "key", "high"],
        [43.432658, 43.432658, "key", "high"],
        [43.455497, 43.762939, "lip", "n"],
        [43.779099, 43.779099, "key", "high"],
        [44.017277, 44.017277, "beat", null],
        [44.02774, 44.02774, "key", "high"],
        [44.520363, 47.010642, "lyric", "After you peeled me"],
        [44.520363, 44.783086, "lip", "a"],
        [44.783086, 44.8306, "lip", "f"],
        [44.8306, 44.984321, "lip", "t"],
        [44.984321, 45.168786, "lip", "r"],
        [45.168786, 45.655103, "lip", "O"],
        [45.655103, 45.752925, "lip", "o"],
        [46.138625, 46.256012, "lip", "p"],
        [46.214088, 46.214088, "beat", null],
        [46.256012, 46.51594, "lip", "e"],
        [46.51594, 46.69202, "lip", "l"],
        [46.69202, 46.851331, "lip", "m"],
        [46.851331, 47.016231, "lip", "e"],
        [47.010642, 49.235402, "lyric", "up off the ground"],
        [47.016231, 47.513728, "lip", "uh"],
        [47.508138, 47.608756, "lip", "p"],
        [47.608756, 47.779246, "lip", "O"],
        [47.779246, 48.050354, "lip", "f"],
        [48.050354, 48.125817, "lip", "th"],
        [48.125817, 48.262768, "lip", "uh"],
        [48.248793, 48.248793, "beat", null],
        [48.262768, 48.419284, "lip", "r"],
        [48.306027, 48.306027, "key", "high"],
        [48.419284, 48.793804, "lip", "O"],
        [48.793804, 49.361174, "lip", "o"],
        [49.361174, 49.537254, "lip", "n"],
        [49.833516, 52.295845, "lyric", "With Gatorade, and"],
        [49.833516, 50.017981, "lip", "e"],
        [50.017981, 50.289089, "lip", "a"],
        [50.289089, 50.414861, "lip", "th"],
        [50.400886, 50.400886, "beat", null],
        [50.414861, 50.543427, "lip", "g"],
        [50.414861, 50.414861, "misc", "spawn_wetness"],
        [50.543427, 50.753046, "lip", "a"],
        [50.753046, 50.873228, "lip", "t"],
        [50.873228, 51.166695, "lip", "O"],
        [51.166695, 51.35116, "lip", "r"],
        [51.35116, 51.714501, "lip", "a"],
        [51.714501, 51.896171, "lip", "d"],
        [51.82513, 51.82513, "key", "high"],
        [51.896171, 52.29305, "lip", "n"],
        [51.941163, 51.941163, "key", "high"],
        [52.295845, 54.526195, "lyric", "cigarettes, and"],
        [52.295845, 52.592107, "lip", "s"],
        [52.322413, 52.322413, "key", "high"],
        [52.39786, 52.39786, "misc", "spawn_poison"],
        [52.508259, 52.508259, "beat", null],
        [52.592107, 52.85483, "lip", "i"],
        [52.85483, 52.977807, "lip", "g"],
        [52.977807, 53.165067, "lip", "O"],
        [53.165067, 53.466919, "lip", "r"],
        [53.466919, 53.60387, "lip", "e"],
        [53.60387, 54.081802, "lip", "s"],
        [54.081802, 54.350115, "lip", "a"],
        [54.350115, 54.526195, "lip", "e"],
        [54.526195, 56.767725, "lyric", "love"],
        [54.526195, 54.719045, "lip", "l"],
        [54.628146, 54.628146, "key", "high"],
        [54.671532, 54.671532, "beat", null],
        [54.719045, 55.722423, "lip", "O"],
        [54.719045, 54.719045, "misc", "spawn_heal"],
        [55.722423, 56.650339, "lip", "o"],
        [56.650339, 56.871138, "lip", "v"],
        [56.764931, 56.764931, "beat", null],
        [58.939382, 58.939382, "beat", null],
        [61.07191, 61.07191, "beat", null],
        [61.44084, 64.791956, "lyric", "Seven minutes and no reply"],
        [61.44084, 61.597356, "lip", "s"],
        [61.597356, 61.868464, "lip", "e"],
        [61.868464, 62.005415, "lip", "v"],
        [62.005415, 62.136777, "lip", "n"],
        [62.136777, 62.287703, "lip", "m"],
        [62.287703, 62.447013, "lip", "i"],
        [62.447013, 62.578375, "lip", "n"],
        [62.578375, 62.704147, "lip", "s"],
        [62.704147, 62.983639, "lip", "a"],
        [62.983639, 63.235182, "lip", "n"],
        [63.156924, 63.156924, "beat", null],
        [63.235182, 63.453187, "lip", "O"],
        [63.453187, 63.662806, "lip", "r"],
        [63.662806, 63.894785, "lip", "e"],
        [63.894785, 64.014966, "lip", "p"],
        [64.014966, 64.115584, "lip", "l"],
        [64.115584, 64.44259, "lip", "a"],
        [64.44259, 64.674569, "lip", "e"],
        [65.250323, 65.250323, "beat", null],
        [65.733845, 67.472289, "lyric", "Guess I might as well"],
        [65.733845, 65.876387, "lip", "g"],
        [65.876387, 66.013338, "lip", "e"],
        [66.013338, 66.161469, "lip", "s"],
        [66.161469, 66.312395, "lip", "i"],
        [66.312395, 66.449346, "lip", "m"],
        [66.449346, 66.597477, "lip", "i"],
        [66.597477, 66.67853, "lip", "t"],
        [66.67853, 66.756788, "lip", "a"],
        [66.756788, 66.85461, "lip", "s"],
        [66.85461, 66.952433, "lip", "w"],
        [66.952433, 67.111744, "lip", "e"],
        [67.111744, 67.279439, "lip", "l"],
        [67.430365, 67.567316, "lip", "t"],
        [67.472289, 67.472289, "beat", null],
        [67.472289, 69.546123, "lyric", "die!"],
        [67.509422, 67.509422, "key", "high"],
        [67.567316, 68.184995, "lip", "O"],
        [67.768009, 67.768009, "key", "high"],
        [68.006705, 68.006705, "key", "high"],
        [68.184995, 68.956394, "lip", "a"],
        [68.246483, 68.246483, "offbeat", null],
        [68.333254, 68.333254, "key", "high"],
        [68.505645, 68.505645, "key", "high"],
        [68.863688, 68.863688, "key", "high"],
        [68.956394, 69.546123, "lip", "e"],
        [68.977356, 68.977356, "offbeat", null],
        [69.060944, 69.060944, "key", "high"],
        [69.372574, 69.372574, "key", "high"],
        [69.546123, 71.513751, "lyric", "Did you go"],
        [69.546123, 69.705434, "lip", "d"],
        [69.546623, 69.546623, "key", "high"],
        [69.548918, 69.548918, "beat", null],
        [69.705434, 69.931823, "lip", "i"],
        [69.906324, 69.906324, "key", "high"],
        [69.931823, 70.105108, "lip", "o"],
        [70.105108, 70.105108, "key", "high"],
        [70.105108, 70.392986, "lip", "O"],
        [70.392986, 70.580246, "lip", "g"],
        [70.443389, 70.443389, "key", "high"],
        [70.580246, 71.513751, "lip", "O"],
        [70.604177, 70.604177, "key", "high"],
        [70.980454, 70.980454, "key", "high"],
        [71.187655, 71.187655, "key", "high"],
        [71.497628, 71.497628, "key", "high"],
        [71.513751, 71.689831, "lip", "o"],
        [71.650128, 71.650128, "key", "high"],
        [71.689831, 71.829577, "lip", "t"],
        [71.692626, 71.692626, "beat", null],
        [71.692626, 73.615534, "lyric", "to the show"],
        [71.829577, 72.167763, "lip", "O"],
        [72.003199, 72.003199, "key", "high"],
        [72.167763, 72.265586, "lip", "l"],
        [72.212058, 72.212058, "key", "high"],
        [72.265586, 72.511539, "lip", "s"],
        [72.511539, 73.285733, "lip", "O"],
        [72.581704, 72.581704, "key", "high"],
        [72.747465, 72.747465, "key", "high"],
        [73.085617, 73.085617, "key", "high"],
        [73.262981, 73.262981, "key", "high"],
        [73.285733, 73.618329, "lip", "o"],
        [73.3039, 73.3039, "offbeat", null],
        [73.615534, 75.750857, "lyric", "the show I wanted"],
        [73.618329, 73.682613, "lip", "l"],
        [73.625998, 73.625998, "key", "high"],
        [73.682613, 73.886642, "lip", "s"],
        [73.809992, 73.809992, "key", "high"],
        [73.867078, 73.867078, "beat", null],
        [73.886642, 74.15216, "lip", "O"],
        [74.15216, 74.336625, "lip", "i"],
        [74.336625, 74.493141, "lip", "w"],
        [74.490346, 74.663631, "lip", "uh"],
        [74.663631, 74.781018, "lip", "t"],
        [74.781018, 75.65024, "lip", "e"],
        [74.932193, 74.932193, "key", "high"],
        [75.65024, 75.750857, "lip", "d"],
        [75.750857, 77.556379, "lyric", "to go to"],
        [75.750857, 75.966067, "lip", "t"],
        [75.960477, 75.960477, "beat", null],
        [75.966067, 76.122582, "lip", "g"],
        [76.122582, 76.295868, "lip", "O"],
        [76.295868, 76.435614, "lip", "t"],
        [76.435614, 77.559174, "lip", "O"],
        [77.363529, 77.363529, "offbeat", null],
        [77.398715, 77.398715, "key", "high"],
        [77.510263, 77.510263, "offbeat", null],
        [77.547899, 77.547899, "key", "high"],
        [77.556379, 79.079613, "lyric", "with you?"],
        [77.559174, 77.69333, "lip", "w"],
        [77.69333, 77.89177, "lip", "i"],
        [77.89177, 78.087415, "lip", "th"],
        [77.932465, 77.932465, "key", "high"],
        [78.081825, 78.081825, "beat", null],
        [78.087415, 78.878379, "lip", "O"],
        [78.878379, 79.096383, "lip", "o"],
        [80.015913, 81.966771, "lyric", "Motherfucker!"],
        [80.015913, 80.074607, "lip", "m"],
        [80.074607, 80.14448, "lip", "uh"],
        [80.14448, 80.187801, "lip", "th"],
        [80.187801, 80.260469, "lip", "uh"],
        [80.245097, 80.245097, "beat", null],
        [80.260469, 80.41419, "lip", "f"],
        [80.41419, 80.528782, "lip", "uh"],
        [80.528782, 80.604245, "lip", "e"],
        [80.604245, 81.4553, "lip", "O"],
        [81.4553, 81.940219, "lip", "o"],
        [81.653796, 81.653796, "key", "high"],
        [81.83116, 81.83116, "key", "high"],
        [82.204122, 82.204122, "key", "high"],
        [82.436318, 82.436318, "beat", null],
        [84.742132, 84.742132, "beat", null],
        [85.313795, 85.313795, "key", "high"],
        [85.655263, 85.655263, "key", "high"],
        [86.414894, 86.414894, "beat", null],
        [86.986457, 86.986457, "offbeat", null],
        [87.187691, 87.187691, "misc", "guitar_end"],
        [87.272936, 87.272936, "misc", "bass_end"],
        [91.047483, 91.047483, "misc", "keys_end"],
    ];

    export function interlaceClickCues<TCommand>(
        cuesheet: DataCuesheet<TCommand>,
        measureCommand: TCommand,
        clicksPerMeasure: Integer,
    ): DataCuesheet<TCommand | "click"> {
        if (clicksPerMeasure < 1) {
            Logger.logContractViolationError(
                "DataCuesheet.interlaceClickCues",
                new Error("clicksPerMeasure must be at least 1"),
                { clicksPerMeasure },
            );
            return cuesheet;
        }

        const measureCommands = cuesheet
            .filter(([_, __, command]) => command === measureCommand)
            .map(([start]) => start);

        const clickCuesheet: DataCuesheet<"click"> = [];

        for (let m = 0; m < measureCommands.length - 1; m++) {
            const start = measureCommands[m];
            const length = measureCommands[m + 1] - start;
            const deltaPerClick = length / (clicksPerMeasure + 1);

            if (clickCuesheet.length === 0) {
                for (let i = 1; true; i++) {
                    const click = start - i * deltaPerClick;
                    if (click < 0) {
                        break;
                    }

                    clickCuesheet.push([click, click, "click", null]);
                }
            }

            for (let i = 1; i <= clicksPerMeasure; i++) {
                const click = start + i * deltaPerClick;
                clickCuesheet.push([click, click, "click", null]);
            }
        }

        return [...cuesheet, ...clickCuesheet].sort(([a], [b]) => a - b);
    }
}
